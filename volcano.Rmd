---
title: "tmt_default"
author: "A.G."
date: "`r Sys.Date()`"
---
```{r echo=FALSE, warning=FALSE}

library(janitor)

cells_comparison_results <- cells_comparison$ComparisonResult %>% 
  clean_names()

cells_comparison_results <- left_join(
  cells_comparison_results,
  select(evidence, "Proteins", "Gene names"),
  by = c("protein" = "Proteins")
) %>% distinct() %>% 
  clean_names()

cells_comparison_results <- cells_comparison_results %>% 
  dplyr::mutate(
    color = case_when(
      pvalue < 0.01 & log2fc > 0 ~ "#488f31",
      pvalue < 0.01 & log2fc < 0 ~ "#de425b",
      pvalue < 0.05 & log2fc > 0 ~ "#a8c162",
      pvalue < 0.05 & log2fc < 0 ~ "#f9a160",
      TRUE ~ "grey"
    ),
    label = case_when(
      pvalue < 0.01 ~ gene_names
    )
  )

#paste(Gene.names, Protein, sep = "\n")

cells_comparison_results %>% 
  ggplot(aes(
    x = log2FC,
    y = -log10(pvalue),
    color = color,
    label = label
  )) +
  geom_point() +
  scale_colour_identity() +
  geom_text_repel(size = 3, force_pull = 5)
```

```{r echo=FALSE, warning=FALSE}

cells_comparison_results %>% 
  ggplot(aes(
    x = log2fc,
    y = pvalue,
    color = color,
    label = label
  )) +
  geom_point() +
  scale_colour_identity() +
  scale_y_continuous(
    name = "p-value",
    labels = label_math(expr = .x),
    trans = custom_reverse_log_trans(10),
    breaks = c(1, 0.05, 0.01, 0.001, 1e-04, 1e-05, 1e-06, 1e-07, 1e-08),
    limits = c(1, 1e-08)
  ) +
  ggthemes::theme_base(
    base_size = 12, base_family = "googlesans_regular"
  ) +
  theme(
    plot.background = element_rect(color = NA)
  ) +
  xlab(
    bquote(log[2]("fold change"))
  ) +
  geom_text_repel(
    size = 3,
    data          = subset(cells_comparison_results, log2fc > 0),
    nudge_x       = 0.6 - subset(cells_comparison_results, log2fc > 0)$log2fc,
    segment.size  = 0.2,
    direction     = "y",
    hjust         = 0,
    family = "googlesans_regular"
  ) +
  geom_text_repel(
    size = 3,
    data          = subset(cells_comparison_results, log2fc < 0),
    nudge_x       = -0.8 - subset(cells_comparison_results, log2fc < 0)$log2fc,
    segment.size  = 0.1,
    direction     = "y",
    hjust         = 1,
    family = "googlesans_regular"
  )
```
```{r}
plot(Hierar_cl)
```

